# ShinyImgVoteR

Is an open-source R Shiny image voting application initially developed
for collaborative reviewing of mutation calls from sequencing data in
the course of the [Beyond 1 Million Genomes (B1MG)
project](https://b1mg-project.eu). Refer to [ShinyImgVoteR’s role in the
B1MG
project](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/doc/01-introduction.md)
for more context.

## Overview

The application enables users to vote on any set of images with features
for tracking user behavior (e.g. average time before casting a vote),
handling vote changes by allowing users to update their previous votes,
and supporting keyboard shortcuts for efficient voting.

Users get presented a randomly picked image, as for instance an IGV
(Integrative Genomics Viewer) screenshot displaying a genetic mutation,
and can express their opinion on the shown mutation using predefined
categories, confirming or rejecting its validity, proposing that there
is a different mutation at the same location.

such as “True Positive”, “False Positive”, or “Uncertain”. Votes are
stored in a TSV file per user, and an SQLite database maintains
aggregated vote counts for each mutation.

FLOW:

- User logs in → triggers mutation loading
- Mutation image and data displayed
- User makes voting choices → stored in TSV file
- Database updated with vote counts
- Next mutation loaded automatically
- Process repeats until all mutations voted on

## Development Prerequisites

- R (developed with v4.5.0)

## Quickstart

1.  Start the Shiny application:

``` bash
R -e "renv::restore()"
R -e "ShinyImgVoteR::run_app()"
```

2.  Navigate to <http://localhost:8000>

## Features

### Dynamic Database Updates

The application provides an admin button to manually update the database
with new entries from the `to_be_voted_images_file` (configured in
`config.yaml`). When the “Update Database” button is clicked in the
Admin panel: - The system reads the to_be_voted_images_file - New
entries are identified and added to the database without duplicates -
New images become available for voting immediately - Admin users receive
feedback on the number of entries added

This allows administrators to add new images for voting without
requiring users to restart their sessions.

**Example:** 1. Start the application 2. Add new entries to
`./app_env/images/to_be_voted_images.tsv`:
`tsv coordinates REF ALT path chr7:7000 A G ./app_env/images/pngs/new_image.png`
3. Login as an admin user 4. Navigate to the Admin panel 5. Click the
“Update Database” button 6. See confirmation: “Successfully added 1 new
entries to the database”

For more details, see
[dev_scripts/README.md](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/dev_scripts/README.md).

### AUTHOR

Written by Ivo Christopher Leist, PhD Candidate at CNAG
<https://www.cnag.eu>.

### COPYRIGHT AND LICENSE

Copyright (C) 2025, Ivo Christopher Leist - CNAG.

GPLv3 - GNU General Public License v3.0

# Package index

## All functions

- [`aboutServer()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/aboutServer.md)
  : About module server logic
- [`aboutUI()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/aboutUI.md)
  : About module UI
- [`adminServer()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/adminServer.md)
  : Admin module server
- [`adminUI()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/adminUI.md)
  : Admin module UI
- [`build_base_url()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/build_base_url.md)
  : Build base URL from session data, accounting for reverse proxy
  subpaths
- [`create_database()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/create_database.md)
  : Initialize SQLite database
- [`create_user_directory()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/create_user_directory.md)
  : Create user directory structure
- [`faqServer()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/faqServer.md)
  : FAQ module server logic
- [`faqUI()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/faqUI.md)
  : FAQ module UI
- [`generate_password()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/generate_password.md)
  : Generate a random password
- [`get_app_dir()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/get_app_dir.md)
  : Get the path to the Shiny app directory
- [`init_environment()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/init_environment.md)
  : Initialize environment for the application
- [`leaderboardServer()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/leaderboardServer.md)
  : Leaderboard Server Module
- [`leaderboardUI()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/leaderboardUI.md)
  : Leaderboard module UI
- [`load_config()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/load_config.md)
  : Load voting app configuration
- [`loginServer()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/loginServer.md)
  : Login module server logic
- [`loginUI()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/loginUI.md)
  : Login module UI
- [`makeVotingAppServer()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/makeVotingAppServer.md)
  : Factory function to create the Shiny server for the voting
  application
- [`query_annotations_db_by_coord()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/query_annotations_db_by_coord.md)
  : Query annotations table by coordinates and optionally REF/ALT This
  function queries the annotations table for a given set of coordinates,
  returning only the specified columns. Optionally filters by REF and
  ALT to handle cases where coordinates alone are not unique.
- [`reset_user_annotations()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/reset_user_annotations.md)
  : Reset user annotation file and update database vote counts
- [`run_voting_app()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/run_voting_app.md)
  : Run B1MG Variant Voting Shiny Application
- [`safe_dir_create()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/safe_dir_create.md)
  : Create a Directory Safely
- [`userStatsServer()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/userStatsServer.md)
  : User Stats Server Module
- [`userstatsUI()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/userstatsUI.md)
  : User statistics module UI
- [`validate_cols()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/validate_cols.md)
  : Validate column names passed by config Ensures that the columns
  specified in the configuration are safe and exist in the database
  schema.
- [`votingAppUI()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/votingAppUI.md)
  : Voting app UI
- [`votingServer()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/votingServer.md)
  : Voting module server logic
- [`votingUI()`](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/reference/votingUI.md)
  : Voting module UI

# Articles

### Index

- [ShinyImgVoteR](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/articles/00-vignettes.md):
- [The role of ShinyImgVoteR in the B1MG
  project](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/articles/01-introduction.md):
- [02.
  Setup](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/articles/02-setup.md):
- [03.
  Usage](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/articles/03-usage.md):
- [04. Test
  Coverage](https://biomedicalgenomicscnag.github.io/ShinyImageVoteR/articles/04-test-coverage.md):
