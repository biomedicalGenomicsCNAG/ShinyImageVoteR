---
title: "03. Usage"
author: "Ivo Christopher Leist"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{03. Usage}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
runtime: shiny_prerendered
---

## Introduction

<div class="fancy-box">
  In this vignette different parts of the ShinyImgVoteR application are demonstrated.

  - Login: Login with user credentials (userid/password) in order to access the application.
  - Voting: Voting on displayed images
  - Leaderboard: Shows voting progress of different user groups in real-time.
  - User Statistics: Shows the user's voting behavior statistics.
  - Admin View: Administrative functionalities for creating users, download votes etc.
</div>


```{r setup, include=FALSE}
# load your package and shiny
library(ShinyImgVoteR)
library(shiny)

Sys.setenv("IMGVOTER_BASE_DIR" = getwd())
config_file_path <- file.path(
  get_app_dir(),
  "default_env",
  "config",
  "config.yaml"
)
cfg <- load_config(config_file_path)

init_environment(config_file_path)

shiny::addResourcePath(
  prefix = "images",
  directoryPath = cfg$images_dir
)

shiny::addResourcePath(
  "www",
  system.file(
    "shiny-app", "www",
    package = "ShinyImgVoteR"
  )
)

message("CONFIG YAML:\t", normalizePath(config_file_path))
message("IMAGES DIR:\t", normalizePath(cfg$images_dir))
message("SQLITE DB:\t", normalizePath(cfg$sqlite_file))
```

<div class="fancy-box">
## Login View

```{r ui, echo=FALSE}
# shiny::fluidPage(
#   shiny::tags$h3("Current Working Directory"),
#   shiny::verbatimTextOutput("cwd")
# )
```

```{r ui2, echo=FALSE, include=TRUE}
Sys.setenv("IMGVOTER_CONFIG_FILE" = config_file_path)
votingAppUI(cfg)
```

```{r server, context="server", include=FALSE}
# output$cwd <- renderText({
#   getwd()
# })
con <- DBI::dbConnect(RSQLite::SQLite(), dbname = cfg$sqlite_file)
on.exit(DBI::dbDisconnect(con), add = TRUE)
makeVotingAppServer(con)
```
</div>

<!-- TODO
Rewrite the application which skips the login view for demonstration purposes.
so the voting view can be shown directly in the vignette.
-->
```{r ui3, echo=FALSE, include=TRUE}
Sys.setenv("IMGVOTER_CONFIG_FILE" = config_file_path)
votingAppUI(cfg)
```