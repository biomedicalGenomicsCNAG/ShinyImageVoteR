---
title: "ShinyImgVoteR"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{ShinyImgVoteR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
runtime: shiny_prerendered
---

## Introduction

This vignette demonstrates…

## Basic App

```{r setup, include=FALSE}
# load your package and shiny
library(ShinyImgVoteR)
library(shiny)

config_file_path <- file.path(get_app_dir(), "default_env", "config", "config.yaml")
cfg <- load_config(config_file_path)

init_environment(config_file_path)

shiny::addResourcePath(
  prefix = "images",
  directoryPath = cfg$images_dir
)
shiny::addResourcePath(
  "www",
  system.file("shiny-app","www",package="ShinyImgVoteR")
)

message("CONFIG YAML:\t", normalizePath(config_file_path))
message("IMAGES DIR:\t", normalizePath(cfg$images_dir))
message("SQLITE DB:\t", normalizePath(cfg$sqlite_file))
```


## UI (this becomes part of the HTML shell)

```{r ui, echo=FALSE}
fluidPage(
  tags$h3("Current Working Directory"),
  verbatimTextOutput("cwd")
)
```


<!-- ```{r ui2, echo=FALSE}
votingAppUI()
``` -->

## Server logic (runs only when you “Run Document”)

```{r server, context="server"}
output$cwd <- renderText({
  getwd()
})
con <- DBI::dbConnect(RSQLite::SQLite(), dbname = cfg$sqlite_file)
on.exit(DBI::dbDisconnect(con), add = TRUE)
makeVotingAppServer(con)
```



<!-- ```{r server, context="server"}
con <- dbConnect(RSQLite::SQLite(), dbname = cfg$sqlite_file)
on.exit(dbDisconnect(con), add = TRUE)

# this *starts* the app server; because it's in context="server",
# it won't run during the knit step, only when Shiny actually launches
makeVotingAppServer(con)
``` -->